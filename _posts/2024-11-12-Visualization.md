---
layout: post
title: Data visualization using Plotly.js
subtitle: A CNV calling app designed During my time at Devyser AB. Here is a small portion of the app. The app uses data generated by their internal software.
cover-img: /assets/img/newplot_CNV.png
thumbnail-img: https://plotly.github.io/documentation/all_static/images/graphing_library.svg
share-img: /assets/img/newplot_CNV.png
tags: [Data, Plotly, ]
comments: true
---

# A CNV calling app designed During my time at Devyser AB. Here is a small portion of the app. The app uses data generated by their internal software.

<html lang="en">
<head>
<!-- Plotly.js -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
<div id="myDiv" style="width: 1500px; height: 400px;"><!-- Plotly chart will be drawn inside this DIV --></div> 
<script>
Plotly.d3.json('https://raw.githubusercontent.com/venta380/coursera_test/main/BRACA_CNV_info.json', function(error, data) {
  if (error) {
      console.error('Error fetching the JSON file:', error);
      return;
  }
  //extract normal samples from json
  const output = document.getElementById('output');
  const normalSamples = {};
  const CNVSamples = {};
  let result = '';
  for (const chromosome in data) {
      normalSamples[chromosome] = [];
      CNVSamples[chromosome] = [];
      result += `Chromosome: ${chromosome}\n`;
      for (const sample in data[chromosome]) {
          if (data[chromosome][sample] == 'Normal sample') {
              normalSamples[chromosome].push(sample);
          } else {
              CNVSamples[chromosome].push(sample);
          }
      }
  }
  Plotly.d3.csv('https://raw.githubusercontent.com/venta380/coursera_test/main/BRACA_Median_Normalization_data.csv', function (err, rows) {
    if (err) {
      console.error('Error loading CSV file:', err);
      return;
    }
  
    function unpack(rows, key) {
      return rows.map(function (row) {
        return row[key];
      });
    }
  
    // Select first sample in the dropdown menu
    var firstSample = Object.keys(rows[0]).find(column => column !== 'Amplicon names' && column !== 'CHROM' && column !== 'Length' && column !== '');
  
    // Create traces for each chromosome
    var chromosomes = [...new Set(unpack(rows, 'CHROM'))];
    var scatterTraces = chromosomes.map(function (chrom) {
      var chromRows = rows.filter(row => row['CHROM'] === chrom);
      return {  
        type: "scatter",
        mode: "markers",
        name: `${firstSample} - Chr - ${chrom}`,
        x: unpack(chromRows, 'Amplicon names'),
        y: unpack(chromRows, firstSample),
        text: chrom,
        marker: { size: 10,  } //color:'#5A50C8'
      };
    });
  
    // Create a dropdown menu using Plotly's updatemenus
    var columns = Object.keys(rows[0]).filter(column => column !== 'Amplicon names' && column !== 'CHROM' && column !== 'Length' && column !== '');
    var updateMenus = [{
      buttons: columns.map(function (column) {
        return {
          method: 'restyle',
          args: ['y', [unpack(rows.filter(row => row['CHROM'] === scatterTraces[0].text), column)]],
          label: column
        };
      }),
      direction: 'down',
      showactive: true,
      x: 0.14,
      xanchor: 'left',
      y: 1.04,
      yanchor: 'top'
    }];
  
    // Calculate the number of points in each chromosome and add vertical dashed lines
    var shapes = [];
    var xCounter = 0;
    chromosomes.forEach(function (chrom, index) {
      var chromRows = rows.filter(row => row['CHROM'] === chrom);
      xCounter += chromRows.length;
      if (index < chromosomes.length - 1) { // Skip the last vertical line
        shapes.push({
          type: 'line',
          x0: xCounter - 0.5,
          y0: 0,
          x1: xCounter - 0.5,
          y1: 2.0,
          line: { color: '#0a0a0a', width: 2 }
        });
      }
      shapes.push({
        type: 'line',
        y0: 1.0,
        y1: 1.0,
        x0: 0,
        x1: xCounter,
        line: { color: '#dbd9d9', width: 2, dash: 'dash', opacity: 0.5 }
      });
      shapes.push({
        type: 'line',
        y0: 0.8,
        y1: 0.8,
        x0: 0,
        x1: xCounter,
        line: { color: '#ff0000', width: 2, dash: 'dash', opacity: 0.5 }
      });
      shapes.push({
        type: 'line',
        y0: 0.5,
        y1: 0.5,
        x0: 0,
        x1: xCounter,
        line: { color: '#eda4a4', width: 2, dash: 'dash', opacity: 0.5 }
      });
      shapes.push({
        type: 'line',
        y0: 1.5,
        y1: 1.5,
        x0: 0,
        x1: xCounter,
        line: { color: '#96c2f2', width: 2, dash: 'dash', opacity: 0.5 }
      });
      shapes.push({
        type: 'line',
        y0: 1.2,
        y1: 1.2,
        x0: 0,
        x1: xCounter,
        line: { color: '#024d9f', width: 2, dash: 'dash', opacity: 0.5 }
      });
    });
  
    var layout = {
      template: "plotly_white",
      autosize: true,
      gridcolor: 'white',
      xaxis: { gridcolor: "#FFFFFF" },
      yaxis: { gridcolor: "#FFFFFF", range: [-0.5, 2.2]},
      shapes: shapes,
      updatemenus: updateMenus,
      annotations: [{
        text: 'Select sample:',
        x: 0.1,
        xanchor: 'left',
        y: 2.2,
        yanchor: 'top',
        showarrow: false,
        font: { size: 13 }
      }], title:{text:'CNV Analysis'}
    };
    var config = { 'displaylogo': false, 'modeBarButtonsToRemove': ['zoom2d', 'pan2d', 'lasso2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'resetScale2d', 'zoom3d', 'Select Box','hoverClosestCartesian', 'toggleHover']}
  
    Plotly.newPlot('myDiv', scatterTraces, layout, config);
  });
});
</script>
</body>

